{% extends 'base.html.twig' %}

{% block title %}Détail de l'événement{% endblock %}

{% block body %}
    <div class="container mt-4">
        <h1>{{ evenement.nom }}</h1>
        <p><strong>Lieu :</strong> {{ evenement.lieu }}</p>
        <p><strong>Date :</strong> {{ evenement.date|date('d/m/Y H:i') }}</p>
        <p><strong>Capacité :</strong> {{ evenement.capacite }}</p>

        {% set nb_inscrits = evenement.inscriptionevenements|filter(i => i.statut == 'Approved')|length %}
        {% set complet = evenement.capacite is not null and nb_inscrits >= evenement.capacite %}

        <hr>

        {% if complet %}
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-circle me-2"></i>
                Cet événement est <strong>complet</strong>. Aucune inscription possible.
            </div>
        {% else %}
            <p class="text-muted">{{ evenement.capacite - nb_inscrits }} place{{ (evenement.capacite - nb_inscrits) > 1 ? 's' : '' }} restante{{ (evenement.capacite - nb_inscrits) > 1 ? 's' : '' }}.</p>
        {% endif %}

        {% if isRegistered %}
            <div class="alert alert-success">
                Vous êtes déjà inscrit à cet événement.
                <form method="post" action="{{ path('app_evenement_front_desinscription', {'idevenement': evenement.idevenement}) }}" class="d-inline">
                    <button class="btn btn-sm btn-outline-danger ms-2">Se désinscrire</button>
                </form>
            </div>
        {% else %}
            <form method="post" action="{{ path('app_evenement_front_inscription', {'idevenement': evenement.idevenement}) }}">
                <button class="btn btn-primary" {% if complet %}disabled{% endif %}>
                    S'inscrire
                </button>
            </form>
        {% endif %}

        <hr>

        <a href="{{ path('app_evenement_front_index') }}" class="btn btn-secondary mt-3">← Retour à la liste</a>
    </div>
{% endblock %}